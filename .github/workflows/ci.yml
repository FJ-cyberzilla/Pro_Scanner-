name: OSINT Tool CI

on: [push, pull_request]

jobs:
  quality:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.10", "3.11", "3.12"]

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install mypy pylint httpx aiosqlite beautifulsoup4

    - name: Create src directory if missing
      run: |
        if [ ! -d "src" ]; then
          mkdir -p src
          # Move main Python file to src/ if it's in root
          if [ -f "osint_tool.py" ]; then
            mv osint_tool.py src/
          fi
          # Create __init__.py to make it a package
          touch src/__init__.py
        fi

    - name: Run MyPy (strict type checking)
      run: |
        # Check if we have Python files to analyze
        if [ -d "src" ]; then
          mypy src/ --strict
        else
          echo "No src directory found - checking for Python files in root"
          mypy *.py --strict || true
        fi

    - name: Run Pylint
      run: |
        if [ -d "src" ]; then
          pylint src/ --fail-under=9.0
        else
          pylint *.py --fail-under=9.0
        fi

    - name: Run tests (if any)
      run: |
        python -m pytest tests/ -v || echo "No tests found"
